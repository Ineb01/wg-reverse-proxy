http:
  middlewares:
    strip-api-prefix:
      stripPrefix:
        prefixes:
          - "/api"
        forceSlash: false
    
    add-trailing-slash:
      redirectRegex:
        regex: "^(https?://[^/]+/[^/]+)$"
        replacement: "${1}/"
        permanent: true
    
    ollama-headers:
      headers:
        customRequestHeaders:
          Host: "192.168.0.102:11434"
        hostsProxyHeaders:
          - "X-Forwarded-Host"

  services:
    ollama:
      loadBalancer:
        passHostHeader: false
        servers:
          - url: "http://192.168.0.102:11434"

  routers:
    ollama:
      rule: "Host(`ollama.wg.dphx.eu`)"
      service: "ollama"
      entryPoints:
        - "websecure"
      tls:
        certResolver: letsencrypt
      middlewares:
        - "ollama-headers"
    
    # Specific router for API calls
    ollama-api:
      rule: "Host(`ollama.wg.dphx.eu`) && PathPrefix(`/api`)"
      priority: 200  # Higher priority than main router
      service: "ollama"
      entryPoints:
        - "websecure"
      tls:
        certResolver: letsencrypt
      middlewares:
        - "ollama-headers"
